name: Build and Release Mac Binaries

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        go-version: [ '1.23.1' ]
    steps:
      - uses: actions/checkout@v3
      
      - name: Install X11 dependencies
        run: brew update && brew install libx11 glfw xvfb libxinerama libxcursor libxi mesa-glu libxrandr libxi xorg-server

      - name: Install XQuartz (if needed)
        run: brew install --cask xquartz

      - name: Build for multiple architectures
        run: |
          # Create build matrix for different operating systems and architectures
          matrix:
            os: [linux, windows, darwin]
            arch: [amd64, arm64]
          
          # Loop through matrix combinations
          strategy:
            matrix:
              allow_failures:
                - os: windows
                - arch: arm64
          
          # Build for each combination
          - run: |
            CGO_ENABLED=0 GOOS={{ matrix.os }} GOARCH={{ matrix.arch }} go build -o ${{ matrix.os }}-{{ matrix.arch }} ./main.go
          
      - name: Publish to GitHub Packages
        uses: actions/upload-artifact@v3
        with:
          name: binaries
          path: |
            linux-amd64
            linux-arm64
            windows-amd64
            darwin-amd64
          
